# Git: Commit Rules

## Commit

git 이용 시 버전 관리를 위해 작성되는 커밋은 Pull Request(이하 PR)와 이에 동반되는 코드 리뷰(Code Review)가 이뤄질 수 있습니다.

따라서 작성자는 리뷰어가 코드를 읽고 제대로 의견을 줄 수 있도록 커밋을 가능한 한 짧게 유지 하도록 노력해야 합니다.

본 내용은 코드 커밋을 짧게 가져가는 방법에 대해 서술합니다.

## PR당 최대 변경 라인수는 500 라인으로 제한

일반적으로 변경된 소스코드의 라인수가 500 라인을 넘어서면 리뷰어는 피로감을 느끼게 됩니다.

이렇게 되면 작성자가 원하는 피드백을 제대로 받기 힘들 수 있습니다.

따라서 한 PR당 `최대 500 라인`을 넘지 않도록 합니다.

## 한 화면을 넘기는 파일은 하나만 커밋

한 파일을 신규로 생성하거나 그 파일 내 추가/변동 사항이 한 화면(`50라인`)을 넘기는 내용이라면 그 내용은 하나의 커밋으로 둡니다.

## 커밋은 문맥별로 구분

여기서 문맥(Context)이란 특정 소스파일이 있을 때 이와 가장 근접하게 연관되어 변경/추가된 것들을 일컫습니다.

소스상의 문맥들의 대표적인 케이스는 아래와 같습니다.

### 특정 UI 컴포넌트 1개와 이와 연관된 스타일

- 스타일은 Styled-Components 로 구성된 것을 별도 파일(예: styles.ts)로 분리 했을 때
- scss 파일도 포함

### 특정 UI 컴포넌트들에 대하여 같은 목적으로 props 를 수정

- 대체로 수정/추가되는 패턴이 동일한 여러 컴포넌트들을 의미
- e2e test 를 위해 id 를 추가
- 서로 공유되는 interface props 변경으로 함께 변경되는 컴포넌트들

### 연관된 비즈니스 로직

- function 이나 class 로 별도 구분된 것들
- util, store, service, effect(또는 epic, saga), reducer, action, converter 등이 해당
- 단 같은 기능(feature)내의 다른 세부 목적(detailed purpose)들은 하나의 커밋에 묶지 말 것
  - 예: util 과 service 는 1개의 커밋으로 두지 말고 최소 2개의 커밋으로 나눌 것
  - 예: reducer 와 action 이 서로 연관되어도 그 코드 길이가 합쳐서 한 화면에 들어가지 않는다면 커밋을 나눌 것

### 기능 내 모델이나 타입선언

- DTO나 VO, 기능 내 공통 interface 및 type 작성 내용들은 묶을 수 있음
- 단, 필드가 많아서 파일 하나의 길이가 길 경우 그 파일 하나를 하나의 커밋으로 둘 것

### 테스트 코드

- 테스트 내용이 많다면 별도 커밋으로 둘 것
- 단, 테스트 내용에 비해 대상이 되는 코드가 비교적 짧다면 같은 커밋에 둘 수 있음

## 내용이 길 경우 문맥별로 PR

작업 하다보면 내용이 많아서 하나의 문맥으로도 굉장히 많은 코드가 포함될 수 있습니다.

이 때는 위에 예시로 든 각 문맥들을 기준으로 커밋을 하고 이들만 모아 따로 PR을 올리도록 합니다.

그러면 하나의 기능에 대해서 PR이 여럿 올라가게 되지만, 리뷰어는 리뷰하기 보다 편할 것입니다.

## 프로젝트에 영향이 가장 덜 가는 것을 먼저 커밋 하기

문맥별로 나누어 커밋을 하면 특정 커밋 시점의 소스는 수행이 불가 할 수 있습니다.

이는 어쩔 수 없는 것이긴 합니다.

다만, 같은 계층에 해당되는 문맥의 소스를 아래와 같은 순서로 먼저 커밋을 하면 해당 문제를 최소화 할 수 있습니다.

1. 타입 선언부
2. 레포지토리
3. 자료 조작부
4. 서비스
5. 스토어 혹은 액션 & 리듀서
6. 이펙트
7. 표현 컴포넌트
8. 컨테이너 컴포넌트
9. 페이지 및 라우팅
10. 목데이터 및 테스트 코드

단, 테스트 코드는 필요에 따라 각 문맥 사이에 포함될 수 있습니다.

## 테스트용 mock data 가 많다면 별도의 PR로 두기

목데이터는 그 특성상 내용이 많으므로 다른 변동사항과 더불어 PR 기준인 500라인이 넘을 경우 이들 목데이터만 별도 PR로 둡니다.

## Tip1

작업중에 일종의 세이브의 개념으로 커밋을 자주 하게 됩니다.

이 때 정석대로 커밋을 작성 하였지만 이 후 이래저래 수정되는 일이 빈번하여 같은 소스코드에 대하여 여러번 커밋이 작성될 수 있습니다.

이럴 경우, 초기 커밋은 자유롭게 작성하되, 이 후 작업이 끝나 PR을 위한 Push를 하기 전, 로컬 브랜치 작업 내용을 reset 하여 다시 commit 내용을 정리하면 보다 커밋 결과가 깔끔하게 작성될 수 있습니다.

## Tip2

svg 같은 정적 이미지 파일인데 텍스트라 PR 라인수에 추가 될 때가 있습니다.

일반적인 상황에선 500라인을 넘지 않겠지만, 부득이하게 넘는다면 (예: svg 여러개를 함께 적용해야 하는 경우)

해당되는 static asset 을 먼저 PR 로 올리신 뒤 후속으로 실제 코드가 포함된 PR을 올리시면 상대적으로 변경 라인수가 줄어들어 리뷰어가 한결 보기 편할 것입니다.
